"use strict";class EPriceModalSettings{constructor(){}}class ModalButtonConfig{constructor(){this.comments=""}}class EPriceModalButtonConfig{constructor(e){this.buttons=e}}class EPriceModal{constructor(){this._mostRecentMode="",this._mostRecentCPO="",this._vehicleModelCode="",this._legacyEPriceButtonConfig=null,this.getLeadSource=()=>{const e={isMobile:"ontouchstart"in document.documentElement&&navigator.userAgent.match(/Mobi/),isSrp:this._settings.pageIsSrp,isVdp:this._settings.pageIsVdp,isMrp:this._settings.pageIsMrp,isNew:this._settings.pageIsNew},t={type:document.getElementById("eprice_vehType").innerText.trim().toLowerCase(),isCpo:function(){return void 0!==this.MostRecentCPO&&null!=this.MostRecentCPO&&"true"===this.MostRecentCPO.toLowerCase()}};return"ReserveThisVehicle"===this._mostRecentMode?this.getReserveThisVehicleLeadSource(e,t):"PriceDropAlert"===this._mostRecentMode?this.getPriceDropAlertLeadSource(e,t):"GetSalePrice"===this._mostRecentMode?this.getGetSalePriceLeadSource(e,t):"ConfirmAvailability"===this._mostRecentMode?this.getConfirmAvailabilityLeadSource(e,t):"PriceStakPayments"===this._mostRecentMode?this.getPriceStakPaymentsLeadSource(e,t):e.isVdp?this.getVdpLeadSource(e,t):e.isMrp?this.getMrpLeadSource(e,t):this.getSrpLeadSource(e,t)},this.getLeadType=()=>{const e=document.getElementById("eprice_vehType").innerText.trim().toLowerCase();return"u"===e?2:"n"===e?1:this._settings.pageLeadType},this.ePriceData=()=>{var _a,_b,_c,_d,_e;let comment=null===(_a=document.getElementById("ePriceModalComments"))||void 0===_a?void 0:_a.value;const spinCarUserRef=window.spinCarUserReference;spinCarUserRef&&"string"==typeof spinCarUserRef&&""!=spinCarUserRef.trim()&&(comment+=" SpinCar report: "+spinCarUserRef);let optOut=window.jQuery("#optOut","#epriceForm")[0];optOut&&(comment+=", Do Not Sell Personal Info: "+optOut.checked),this._settings.includeUrlForEPriceLeads;const vin=null===(_b=document.getElementById("eprice_vehVin"))||void 0===_b?void 0:_b.innerText.trim(),vehicleId=null===(_c=document.getElementById("eprice_vehId"))||void 0===_c?void 0:_c.innerText.trim(),location=null===(_d=document.getElementById("eprice_vehLocation"))||void 0===_d?void 0:_d.innerText.trim(),toyotaEnhancedLeadForm=document.querySelectorAll("[data-toyota-enhanced-lead]");for(let e=0;e<toyotaEnhancedLeadForm.length;e++){const t=toyotaEnhancedLeadForm[e];comment+=t.checked?"\n"+toyotaEnhancedLeadForm[e].getAttribute("data-toyota-enhanced-lead"):""}let result={Comments:comment,VehicleModelCode:this._vehicleModelCode,VehicleId:vehicleId};return"virtual"!==(null===(_e=this._settings.vehicleType)||void 0===_e?void 0:_e.toLowerCase())&&(result.Vin=vin,result.VehicleType=this._settings.vehicleType,result.AltDealerId=location),this._settings.bodyCodeBottom&&eval(this._settings.bodyCodeBottom),result},console.info("Initializing ePriceModal"),this.setupEvents(),console.info("ePriceModal initialized!")}setupEvents(){var e=document.getElementById("epriceModalSettings");this._settings=null==e?{}:JSON.parse(e.innerHTML);var t=document.getElementById("epriceModalConfig");this._buttonConfig=new EPriceModalButtonConfig(null==t?{}:JSON.parse(t.innerText));var i=".reserveVehicleBtn, .btnPriceDropAlert, .confirmAvailabilityBtn, [data-eprice-modal-button]";!this._settings.shouldDisplayEPrice&&this._settings.pageIsSrp||(i+=", .ePriceBtn"),document.querySelectorAll(i).forEach((e=>{e.addEventListener("click",(e=>{this.setupPrimaryButtonPageModal(e)}))}));const o=document.querySelector(".close");null==o||o.addEventListener("click",(()=>{window.ResetTracker()})),window.jQuery("#primaryButtonPageModal").on("hide.bs.modal",(function(e){e.currentTarget.setAttribute("aria-hidden",!0)})),window.jQuery("#primaryButtonPageModal").on("shown.bs.modal",(e=>{const t=e.relatedTarget;this.trySetModalLabelsByAttribute(t)}));const s=document.getElementById("primaryButtonPageModalButton");s&&s.addEventListener("click",(e=>{const t=e.currentTarget;window.jQuery("#primaryButtonPageModal").on("hidden.bs.modal",(function(){t.focus()}))})),this.getLeadJsContent()}trySetModalLabelsByAttribute(e){var t;const i=document.getElementById("ePriceModalSubmitButton"),o=document.getElementById("ePriceModalTitle"),s=document.getElementById("ePriceModalSubtitle"),r=document.getElementById("defaultDisclaimer");e.dataset.formTitle&&(o.innerHTML=e.dataset.formTitle),e.dataset.formSubtitle&&(s.innerHTML=e.dataset.formSubtitle),e.dataset.formDisclaimer&&(r.innerHTML=e.dataset.formDisclaimer),e.dataset.formButtonLabel&&(i.innerHTML=e.dataset.formButtonLabel,i.value=e.dataset.formTitle);const n=document.getElementById("primaryButtonPageModal").querySelector('input[name="ctaName"]');n&&(n.value=null===(t=e.innerText)||void 0===t?void 0:t.trim())}setupPrimaryButtonPageModal(e){const t=document.getElementById("primaryButtonPageModal"),i=e.currentTarget,o=i.getAttribute("data-mode");this._mostRecentMode=o;const s=this._buttonConfig.buttons.find((e=>e.name==o));if(s){const e=document.getElementById("ePriceModalSubmitButton"),t=document.getElementById("ePriceModalTitle"),i=document.getElementById("ePriceModalSubtitle");e.innerHTML=s.label,e.value=s.label,t.innerHTML=s.title,i.innerHTML=s.comments}else console.warn(`Unsupported EPriceModal mode ${o}`);const r=i.getAttribute("data-name"),n=i.getAttribute("data-vin"),d=i.getAttribute("data-color"),l=i.getAttribute("data-stock"),a=i.getAttribute("data-photo"),c=i.getAttribute("data-vehicleid"),u=i.getAttribute("data-year"),h=i.getAttribute("data-make"),g=i.getAttribute("data-model"),m=i.getAttribute("data-trim"),S=i.getAttribute("data-altdealerlocation"),M=i.getAttribute("data-type");if(this._mostRecentCPO=i.getAttribute("data-cpo"),this._vehicleModelCode=i.getAttribute("data-modelcd"),this._settings.isDigitalGarageEnabled&&this._settings.pageIsNew){const e=window.DGDataHub,t=e?e.getDgid():"";window.DealeronLead.thirdPartyJsonAdapter.setData({dg_dgid:t,dg_modelCd:i.getAttribute("data-modelcd")})}document.querySelectorAll(".ePriceComments").forEach((e=>{e.innerHTML=e.innerHTML.replace("#VEHICLE#",r)})),document.getElementById("eprice_vehName").innerHTML="<b>"+r+"</b>";const p=null==t?void 0:t.querySelector(".vehVin"),y=document.getElementById("eprice_vehVin");y&&(""!==n?(y.innerHTML=n,y.classList.remove("hidden"),null==p||p.classList.remove("hidden")):(y.classList.add("hidden"),null==p||p.classList.add("hidden")));const _=null==t?void 0:t.querySelector(".vehColor"),b=document.getElementById("eprice_vehColor");b&&(""!==d?(b.innerHTML=d,b.classList.remove("hidden"),null==_||_.classList.remove("hidden")):(b.classList.add("hidden"),null==_||_.classList.add("hidden")));const I=null==t?void 0:t.querySelector(".vehStock"),v=document.getElementById("eprice_vehStock");v&&(""!==l?(v.innerHTML=l,v.classList.remove("hidden"),null==I||I.classList.remove("hidden")):(v.classList.add("hidden"),null==I||I.classList.add("hidden"))),document.getElementById("eprice_vehId").innerHTML=c,document.getElementById("eprice_vehYear").innerHTML=u,document.getElementById("eprice_vehMake").innerHTML=h,document.getElementById("eprice_vehModel").innerHTML=g,document.getElementById("eprice_vehTrim").innerHTML=m,document.getElementById("eprice_vehLocation").innerHTML=S,document.getElementById("eprice_vehType").innerHTML=M,document.getElementById("eprice_vehIsCpo").innerHTML=this._mostRecentCPO,document.getElementById("epriceImage").innerHTML=`<img id="eprice_photo" class="img-responsive" alt="${r}" src="${a}" />`,document.getElementById("epriceForm").setAttribute("data-vin",n),this.tryReadLegacyEPriceButtonConfig(i),window.jQuery("#primaryButtonPageModal").modal("show",i),t&&(t.removeAttribute("aria-hidden"),t.querySelectorAll("input:not([type='hidden'])").forEach((e=>e.value="")),t.querySelectorAll("textarea").forEach((e=>e.value="")),t.querySelectorAll(".has-error").forEach((e=>{"label"===e.nodeName.toLocaleLowerCase()?e.parentElement.removeChild(e):e.classList.remove("has-error")})),t.querySelectorAll(".has-success").forEach((e=>e.classList.remove("has-success")))),window.ResetTracker()}tryReadLegacyEPriceButtonConfig(e){var t,i,o,s,r;const n=e.getAttribute("data-epriceconfiglocation"),d=e.getAttribute("data-buttonIdentifier"),l=document.getElementById("ePriceModalSubmitButton"),a=document.getElementById("ePriceModalTitle"),c=document.getElementById("ePriceModalSubtitle"),u=document.getElementById("defaultDisclaimer");if(!this._legacyEPriceButtonConfig){const e=this._settings.ePriceConfigJsContent;let t={};if(e)try{const t=`"${e.replace(/\"/g,'\\"')}"`,i=decodeURIComponent(JSON.parse(t)),o=JSON.parse(i);this._legacyEPriceButtonConfig=o}catch(e){u&&(u.innerHTML=""),console.error("Error reading legacy eprice button config",[e,t[d]])}}this._legacyEPriceButtonConfig&&this._legacyEPriceButtonConfig[d]&&(a.innerHTML=null!==(t=this._legacyEPriceButtonConfig[d].TitleDictionary[n])&&void 0!==t?t:a.innerHTML,c.innerHTML=null!==(i=this._legacyEPriceButtonConfig[d].HeaderDictionary[n])&&void 0!==i?i:c.innerHTML,l.innerHTML=null!==(o=this._legacyEPriceButtonConfig[d].ButtonLabelDictionary[n])&&void 0!==o?o:l.innerHTML,l.value=null!==(s=this._legacyEPriceButtonConfig[d].ButtonLabelDictionary[n])&&void 0!==s?s:l.value,u.innerHTML=null!==(r=this._legacyEPriceButtonConfig[d].DisclaimerDictionary[n])&&void 0!==r?r:u.innerHTML)}ePriceSuccessCallback(e){window.DealeronCookie&&(window.DealeronCookie.setItem(window.DlronGlobal_PriceUnlocked,"?v=7HWvMx0ytdM",172800),window.DealeronLead.defaultSuccessCallBack(e))}getReserveThisVehicleLeadSource(e,t){return"n"===t.type?e.isMobile?this._settings.leadSource.MobileReserveVehicleNew.Id:this._settings.leadSource.ReserveVehicleNew.Id:"u"===t.type?e.isMobile?this._settings.leadSource.MobileReserveVehicleUsed.Id:this._settings.leadSource.ReserveVehicleUsed.Id:e.isNew?e.isMobile?this._settings.leadSource.MobileReserveVehicleNew.Id:this._settings.leadSource.ReserveVehicleNew.Id:e.isMobile?this._settings.leadSource.MobileReserveVehicleUsed.Id:this._settings.leadSource.ReserveVehicleUsed.Id}getPriceDropAlertLeadSource(e,t){return"n"===t.type?e.isMobile?this._settings.leadSource.MobilePriceDropAlertNew.Id:this._settings.leadSource.PriceDropAlertNew.Id:"u"===t.type?e.isMobile?this._settings.leadSource.MobilePriceDropAlertUsed.Id:this._settings.leadSource.PriceDropAlertUsed.Id:e.isNew?e.isMobile?this._settings.leadSource.MobilePriceDropAlertNew.Id:this._settings.leadSource.PriceDropAlertNew.Id:e.isMobile?this._settings.leadSource.MobilePriceDropAlertUsed.Id:this._settings.leadSource.PriceDropAlertUsed.Id}getGetSalePriceLeadSource(e,t){return"n"===t.type?e.isMobile?this._settings.leadSource.MobileGetSalePriceVdpNew.Id:this._settings.leadSource.GetSalePriceVdpNew.Id:"u"===t.type?e.isMobile?this._settings.leadSource.MobileGetSalePriceVdpUsed.Id:this._settings.leadSource.GetSalePriceVdpUsed.Id:e.isNew?e.isMobile?this._settings.leadSource.MobileGetSalePriceVdpNew.Id:this._settings.leadSource.GetSalePriceVdpNew.Id:e.isMobile?this._settings.leadSource.MobileGetSalePriceVdpUsed.Id:this._settings.leadSource.GetSalePriceVdpUsed.Id}getConfirmAvailabilityLeadSource(e,t){return"n"===t.type?e.isMobile?this._settings.leadSource.MobileConfirmAvailabilityVdpNew.Id:this._settings.leadSource.ConfirmAvailabilityVdpNew.Id:"u"===t.type?e.isMobile?this._settings.leadSource.MobileConfirmAvailabilityVdpUsed.Id:this._settings.leadSource.ConfirmAvailabilityVdpUsed.Id:e.isNew?e.isMobile?this._settings.leadSource.MobileConfirmAvailabilityVdpNew.Id:this._settings.leadSource.ConfirmAvailabilityVdpNew.Id:e.isMobile?this._settings.leadSource.MobileConfirmAvailabilityVdpUsed.Id:this._settings.leadSource.ConfirmAvailabilityVdpUsed.Id}getPriceStakPaymentsLeadSource(e,t){return"n"===t.type?e.isVdp?e.isMobile?this._settings.leadSource.MobilePriceStakDetailsNew.Id:this._settings.leadSource.PriceStakDetailsNew.Id:e.isMobile?this._settings.leadSource.MobilePriceStakInventoryNew.Id:this._settings.leadSource.PriceStakInventoryNew.Id:"u"===t.type?e.isVdp?e.isMobile?this._settings.leadSource.MobilePriceStakDetailsUsed.Id:this._settings.leadSource.PriceStakDetailsUsed.Id:e.isMobile?this._settings.leadSource.MobilePriceStakInventoryUsed.Id:this._settings.leadSource.PriceStakInventoryUsed.Id:e.isNew?e.isVdp?e.isMobile?this._settings.leadSource.MobilePriceStakDetailsNew.Id:this._settings.leadSource.PriceStakDetailsNew.Id:e.isMobile?this._settings.leadSource.MobilePriceStakInventoryNew.Id:this._settings.leadSource.PriceStakInventoryNew.Id:e.isVdp?e.isMobile?this._settings.leadSource.MobilePriceStakDetailsUsed.Id:this._settings.leadSource.PriceStakDetailsUsed.Id:e.isMobile?this._settings.leadSource.MobilePriceStakInventoryUsed.Id:this._settings.leadSource.PriceStakInventoryUsed.Id}getVdpLeadSource(e,t){return"u"===t.type?e.isMobile?this._settings.leadSource.MobileEPriceDetailsUsed.Id:t.isCpo()?this._settings.leadSource.VehicleCertified.Id:this._settings.leadSource.EPriceDetailsUsed.Id:"n"===t.type?e.isMobile?this._settings.leadSource.MobileEPriceDetailsNew.Id:this._settings.leadSource.EPriceDetailsNew.Id:this.catchLeadSource(e,t)}getSrpLeadSource(e,t){return"n"===t.type?e.isMobile?this._settings.leadSource.MobileEPriceInventoryNew.Id:this._settings.leadSource.EPriceInventoryNew.Id:"u"===t.type?e.isMobile?this._settings.leadSource.MobileEPriceInventoryUsed.Id:t.isCpo()?this._settings.leadSource.VehicleCertified.Id:this._settings.leadSource.EPriceInventoryUsed.Id:this.catchLeadSource(e,t)}getMrpLeadSource(e,t){return"n"===t.type?e.isMobile?this._settings.leadSource.MobileEPriceModelResearchNew.Id:this._settings.leadSource.EPriceModelResearchNew.Id:this.catchLeadSource(e,t)}catchLeadSource(e,t){return e.isVdp?e.isNew?e.isMobile?this._settings.leadSource.MobileEPriceDetailsNew.Id:this._settings.leadSource.EPriceDetailsNew.Id:e.isMobile?this._settings.leadSource.MobileEPriceDetailsUsed.Id:t.isCpo()?this._settings.leadSource.VehicleCertified.Id:this._settings.leadSource.EPriceDetailsUsed.Id:e.isMrp?e.isMobile?this._settings.leadSource.MobileEPriceModelResearchNew.Id:this._settings.leadSource.EPriceModelResearchNew.Id:e.isNew?e.isMobile?this._settings.leadSource.MobileEPriceInventoryNew.Id:this._settings.leadSource.EPriceInventoryNew.Id:e.isMobile?this._settings.leadSource.MobileEPriceInventoryUsed.Id:t.isCpo()?this._settings.leadSource.VehicleCertified.Id:this._settings.leadSource.EPriceInventoryUsed.Id}getLeadJsContent(){var e,t;window.DealeronLead.addSubmissionMethod("sendePriceSubmit",{leadSource:this.getLeadSource,leadType:this.getLeadType,additionalData:this.ePriceData,successCallback:this.ePriceSuccessCallback}),window.DealeronLead.initialize("#epriceForm","sendePriceSubmit");const i=document.querySelector("#epriceForm input[name=FirstName]");if(null==i||i.addEventListener("blur",(function(){window.DealeronLead.begin()})),"Scion"===this._settings.trackerType){const i=document.getElementById("eprice_vehYear").innerHTML,o=document.getElementById("eprice_vehModel").innerHTML,s=window.tmsomni;s&&(s.prop2=i,s.eVar2=i,s.prop9=o,s.eVar9=o,s.prop10=`${null===(e=this._settings.vehicleType)||void 0===e?void 0:e.toLowerCase()}`,s.eVar16=`${null===(t=this._settings.vehicleType)||void 0===t?void 0:t.toLowerCase()}`)}window.ResetTracker(),null==i||i.addEventListener("focus",(e=>{window.trackerHook({trackId:this.getLeadSource()}),window.ResetTracker()})),this.ePriceData()}}var ePriceModal;function GetLeadSource(){return ePriceModal?ePriceModal.getLeadSource():(console.warn("GetLeadSource() was called, but ePriceModal has not loaded yet."),null)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",(()=>ePriceModal=new EPriceModal)):window.ePriceModal=new EPriceModal;